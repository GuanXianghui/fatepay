-1,-16764109,-16750900,-16777216,-26368,-39424,-16777216,-65536,-3407821,-16777216,-3407872,-6750208,-16777216,-65536,-10066330,-16777216,-6711040,-52,-16777216,-65536,-4144960,-1,-16737997,-16737997,-1,-10066330,-6750157,-16777216,-65536,-4144960,-16777216,-65536,-4144960,-16777216,-10066330,-4144960
SwimLane,-2,true,269,48,446,1894,1
交易网关
Note,1,13,14,166,20,1
支付接口+支付结果通知接口
SwimLane,2,true,13,48,241,1894,1
商户系统
Decision,3,440,1276,100,30
Transition,4,2,569,1233,510,1276,61,3,1
判是否有返回URL
ActionState,5,544,1345,102,30,1
跳转结果页面
FinalState,7,577,1419
InitialState,8,121,97
Transition,8,2,468,1306,412,1345,3,64,1
Y
FinalState,9,485,878
Transition,9,2,512,1306,572,1345,3,5,1
N
ActionState,10,84,162,100,30,1
组织数据
Transition,10,2,594,1375,594,1419,5,7,1

ActionState,11,442,162,100,30,1
接收数据
Transition,12,2,184,177,442,177,10,11,2
入参
页面跳转【1】
ActionState,13,438,233,109,30,1
数据校验【2】
Transition,14,2,492,192,492,233,11,13,1

Decision,15,442,306,100,30
Transition,16,2,492,263,492,306,13,15,1
判结果
ActionState,17,315,387,102,30,1
跳转失败页面
Decision,18,382,733,100,30
ActionState,19,322,804,100,30,1
组织结果
FinalState,20,348,451
FinalState,20,119,891
Transition,21,2,468,336,389,387,15,17,1
N
ActionState,21,87,804,100,30,1
接收结果
Transition,22,2,365,417,365,451,17,20,1

Transition,22,2,419,763,384,804,18,19,1
Y
ActionState,23,560,386,133,30,1
查询支付记录【3】
Transition,23,2,136,834,136,891,21,20,1

Transition,24,2,517,336,600,386,15,23,1
Y
Transition,24,2,322,819,187,819,19,21,2
出参
页面跳转【6】
Decision,25,442,458,100,30
Transition,25,3,484,653,431,697,431,733,33,18,1
判是否有返回URL
ActionState,26,288,623,133,30,1
组织失败结果【4】
Decision,27,382,547,100,30
Transition,28,2,598,416,519,458,23,25,1
判存在
Transition,29,2,481,488,442,547,25,27,1
Y,判金额一致
ActionState,30,572,547,109,30,1
新增记录【7】
Transition,30,2,447,763,488,804,18,35,1
N
Transition,31,2,514,488,603,547,25,30,1
N
Transition,31,3,373,653,431,696,431,733,26,18,1

Transition,32,2,416,577,369,623,27,26,1
N
Note,32,230,130,166,20,1
商户系统-交易网关 支付接口
ActionState,33,449,623,109,30,1
组织结果【5】
Transition,34,2,446,577,488,623,27,33,1
Y
ActionState,35,452,804,102,30,1
跳转结果页面
NoteLink,35,2,264,150,184,166,32,10,1

Transition,36,2,502,834,502,878,35,9,1

Note,37,649,587,166,20,1
交易网关-银行系统 支付接口
NoteLink,38,2,706,607,664,623,37,40,1

Transition,39,2,133,122,133,162,8,10,1

ActionState,40,576,623,100,30,1
组织数据
Note,40,147,754,214,20,1
商户系统-交易网关 支付结果通知接口
Transition,42,2,626,577,626,623,30,40,1

SwimLane,43,true,729,48,248,1894,1
银行系统
ActionState,44,803,623,100,30,1
接收数据
NoteLink,44,2,232,774,168,804,40,21,1

ActionState,45,803,724,100,30,1
组织结果
Transition,46,2,853,653,853,724,44,45,1
逻辑处理
Note,46,154,1295,214,20,1
商户系统-交易网关 支付结果通知接口
ActionState,47,442,991,100,30,1
接收结果
NoteLink,47,2,237,1315,168,1345,46,70,1

Transition,49,2,676,638,803,638,40,44,2
入参
页面跳转【8】
Note,49,608,962,214,20,1
交易网关-银行系统 支付结果通知接口
ActionState,50,441,1061,100,30,1
数据校验
NoteLink,50,2,649,982,542,998,49,47,1

Decision,51,442,1130,100,30
Note,52,620,1443,214,20,1
交易网关-银行系统 支付结果通知接口
NoteLink,53,2,674,1463,544,1487,52,108,1

ActionState,55,310,1194,102,30,1
跳转失败页面
FinalState,56,344,1247
Transition,57,2,361,1224,361,1247,55,56,1

Transition,58,2,461,1160,391,1194,51,55,1
N
Transition,59,2,491,1021,491,1061,47,50,1

Transition,60,2,491,1091,491,1130,50,51,1
判结果
ActionState,61,499,1185,206,48,2
根据交易结果和记录结果
比较是否修改支付结果【10】
ActionState,64,341,1345,100,30,1
组织结果
FinalState,69,116,1432
ActionState,70,84,1345,100,30,1
接收结果
Transition,71,2,133,1375,133,1432,70,69,1

Transition,72,2,341,1360,184,1360,64,70,2
出参
页面跳转【6】
Transition,84,2,517,1160,560,1185,51,61,1
Y
Note,86,579,1036,257,72,4
循环线程会扫描库中支付成功+
未完成通知+通知次数小于5的记录，
后台数据流通知商户系统，每次通知次数+1，
通知成功则记录已通知成功，不再通知！
NoteLink,87,2,679,1108,620,1185,86,61,1

ActionState,108,444,1482,100,30,1
接收结果
ActionState,109,444,1554,100,30,1
数据校验
Decision,110,444,1622,100,30
ActionState,111,311,1679,102,30,1
输出FAILED
FinalState,112,345,1744
ActionState,113,505,1673,206,48,2
根据交易结果和记录结果
比较是否修改支付结果【10】
ActionState,114,384,1840,113,30,1
输出SUCCESS
Transition,117,2,362,1709,362,1744,111,112,1

Transition,118,2,459,1652,396,1679,110,111,1
N
Transition,119,2,494,1512,494,1554,108,109,1

Transition,120,2,494,1584,494,1622,109,110,1
判结果
Transition,124,2,522,1652,562,1673,110,113,1
Y
Synchronization,127,false,741,950,224,5
Transition,128,2,853,754,853,950,45,127,1

Transition,131,3,853,955,853,1496,544,1496,127,108,2
出参
后台数据流【9】
Decision,134,489,1768,100,30
Transition,135,2,588,1721,551,1768,113,134,1
判明确结果
Transition,136,2,518,1798,460,1840,134,114,1
Y，成功/失败
ActionState,137,583,1839,100,30,1
输出FAILED
Transition,138,2,558,1798,613,1839,134,137,1
N
FinalState,140,424,1903
FinalState,141,615,1903
Transition,142,2,440,1870,440,1903,114,140,1

Transition,143,2,632,1869,632,1903,137,141,1

Note,144,745,1132,217,54,3
注意考虑并发，修改的时候，要加上
WHERE STATE!=SUCCESS保证状态
为成功的时候不被改变！
NoteLink,145,2,745,1180,705,1188,144,61,1

Note,147,743,1595,217,54,3
注意考虑并发，修改的时候，要加上
WHERE STATE!=SUCCESS保证状态
为成功的时候不被改变！
NoteLink,148,2,763,1649,685,1673,147,113,1

Note,149,555,1529,147,20,1
商户后台数据流异步通知
NoteLink,150,2,596,1529,544,1512,149,108,1

Transition,151,3,853,955,853,1005,542,1005,127,47,2
出参
页面跳转【9】